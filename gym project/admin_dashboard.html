<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Bill Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Admin Dashboard</h1>

    <h2>Add Member</h2>
    <form id="addMemberForm">
        <label for="memberName">Full Name:</label>
        <input type="text" id="memberName" required>
        <label for="memberAddress">Address:</label>
        <input type="text" id="memberAddress" required>
        <label for="memberEmail">Email:</label>
        <input type="email" id="memberEmail" required>
        <label for="memberRole">Role:</label>
        <select id="memberRole" required>
            <option value="Member">Member</option>
            <option value="User">User</option>
        </select>
        <button type="submit">Add Member</button>
    </form>

    <h2>Create Bill</h2>
    <form id="createBillForm">
        <label for="billMemberName">Member Name:</label>
        <input type="text" id="billMemberName" required>
        <label for="billAmount">Bill Amount:</label>
        <input type="number" id="billAmount" required>
        <label for="feePackage">Fee Package:</label>
        <select id="feePackage" required>
            <option value="Monthly">Monthly</option>
            <option value="Quarterly">Quarterly</option>
            <option value="Yearly">Yearly</option>
        </select>
        <button type="submit">Create Bill</button>
    </form>

    <h2>View and Manage Bills</h2>
    <div id="billList">
        <!-- Bills will be displayed here -->
    </div>

    <script type="module">
        // Import the necessary Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBs5dilMDHrWjDZXE-y4l7hW6JtdlQEI_8",
            authDomain: "gym-management-system-e340c.firebaseapp.com",
            projectId: "gym-management-system-e340c",
            databaseURL: "https://gym-management-system-e340c-default-rtdb.asia-southeast1.firebasedatabase.app/",
            storageBucket: "gym-management-system-e340c.appspot.com",
            messagingSenderId: "1000657710027",
            appId: "1:1000657710027:web:a70b0e5d8125d735c9a44e",
            measurementId: "G-6BVHWQ6183",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Add Member
        document.getElementById("addMemberForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const memberName = document.getElementById("memberName").value;
            const memberAddress = document.getElementById("memberAddress").value;
            const memberEmail = document.getElementById("memberEmail").value;
            const memberRole = document.getElementById("memberRole").value;

            set(ref(db, "users/" + memberName), {
                FullName: memberName,
                Address: memberAddress,
                Email: memberEmail,
                Role: memberRole
            }).then(() => {
                alert("Member added successfully!");
                document.getElementById("addMemberForm").reset();
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        });

        // Create Bill
        document.getElementById("createBillForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const billMemberName = document.getElementById("billMemberName").value;
            const billAmount = document.getElementById("billAmount").value;
            const feePackage = document.getElementById("feePackage").value;
            const billId = new Date().getTime(); // Unique bill ID

            set(ref(db, "bills/" + billMemberName + "/" + billId), {
                Amount: billAmount,
                FeePackage: feePackage,
                Timestamp: new Date().toISOString()
            }).then(() => {
                alert("Bill created successfully!");
                document.getElementById("createBillForm").reset();
                fetchBills(); // Refresh the bill list
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        });

        // Fetch and display bills
        function fetchBills() {
            get(child(ref(db), "bills/")).then((snapshot) => {
                if (snapshot.exists()) {
                    const bills = snapshot.val();
                    const billListDiv = document.getElementById("billList");
                    billListDiv.innerHTML = ""; // Clear previous list

                    Object.keys(bills).forEach((memberName) => {
                        Object.keys(bills[memberName]).forEach((billId) => {
                            const billData = bills[memberName][billId];
                            const billDiv = document.createElement("div");

                            billDiv.innerHTML = `
                                <p><strong>Member:</strong> ${memberName}</p>
                                <p><strong>Amount:</strong> ${billData.Amount}</p>
                                <p><strong>Fee Package:</strong> ${billData.FeePackage}</p>
                                <p><strong>Date:</strong> ${new Date(billData.Timestamp).toLocaleString()}</p>
                                <button onclick="editBill('${memberName}', '${billId}', '${billData.Amount}', '${billData.FeePackage}')">Edit</button>
                                <button onclick="deleteBill('${memberName}', '${billId}')">Delete</button>
                                <hr>
                            `;
                            billListDiv.appendChild(billDiv);
                        });
                    });
                } else {
                    document.getElementById("billList").innerHTML = "<p>No bills found.</p>";
                }
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        }

        // Edit Bill
        window.editBill = function (memberName, billId, currentAmount, currentPackage) {
            const newAmount = prompt("Edit Bill Amount:", currentAmount);
            const newPackage = prompt("Edit Fee Package (Monthly, Quarterly, Yearly):", currentPackage);

            if (newAmount && newPackage) {
                update(ref(db, "bills/" + memberName + "/" + billId), {
                    Amount: newAmount,
                    FeePackage: newPackage,
                    Timestamp: new Date().toISOString()
                }).then(() => {
                    alert("Bill updated successfully!");
                    fetchBills();
                }).catch((error) => {
                    alert("Error: " + error.message);
                });
            }
        };

        // Delete Bill
        window.deleteBill = function (memberName, billId) {
            if (confirm("Are you sure you want to delete this bill?")) {
                remove(ref(db, "bills/" + memberName + "/" + billId)).then(() => {
                    alert("Bill deleted successfully!");
                    fetchBills();
                }).catch((error) => {
                    alert("Error: " + error.message);
                });
            }
        };

        // Fetch bills on page load
        fetchBills();
    </script>
</body>
</html>
